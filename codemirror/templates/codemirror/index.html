<!doctype html>

{% load staticfiles %}


<html>
  <head>
    <title>Overkode</title>
    <link rel="stylesheet" href="{% static "lib/codemirror.css" %}">

    
    <script src="{% static "lib/codemirror.js" %}"></script>
    <script src="{% static "mode/xml/xml.js" %}"></script>
    <link rel="stylesheet" href="{% static "doc/docs.css" %}">

    <style type="text/css">
      .codemirror {border-top: 1px solid black; border-bottom: 1px solid black;}
      .activeline {background: #e8f2ff !important;}
    </style>
  </head>
  <body>
    <h1>Overkode: codemirror + django channels 1</h1>

    <form><textarea id="code" name="code">
</textarea></form>
<script>
    var roomName = {{ room_name_json }};

    var codemirrorSocket = new WebSocket(
        'ws://' + window.location.host +
        '/ws/codemirror/' + roomName + '/');

    codemirrorSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        var message = data['message'];
        document.querySelector('#code').value += (message + '\n');
    };

    codemirrorSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#code').focus();

    // document.querySelector('#code').onkeyup = function(e) {
    //     if (e.keyCode === 13) {  // enter, return
    //         document.querySelector('#chat-message-submit').click();
    //     }
    // };

    document.querySelector('#code').onclick = function(e) {
        var messageInputDom = document.querySelector('#code');
        var message = messageInputDom.value;
        codemirrorSocket.send(JSON.stringify({
            'message': message
        }));

        messageInputDom.value = '';
    };
</script>


    <!-- <script src="/socket.io/socket.io.js"></script>
    <script src="/share/share.js"></script> -->

 <!-- <script src="/codemirror_attach.js"></script> -->
<script>
    var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        mode: "application/xml",
        lineNumbers: true,
        lineWrapping: true,
        onCursorActivity: function() {
            editor.setLineClass(hlLine, null);
            hlLine = editor.setLineClass(editor.getCursor().line, "activeline");
        }
    });
    var hlLine = editor.setLineClass(0, "activeline");
    sharejs.open('hello', 'text', function(error, doc) {
        doc.attach_codemirror(editor);
    });

</script>

    <!-- <p>CodeMirror + ShareJS integration, open a 2nd window and type in it</p> -->

  </body>
</html>
